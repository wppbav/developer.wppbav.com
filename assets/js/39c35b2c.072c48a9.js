"use strict";(self.webpackChunkthe_fount=self.webpackChunkthe_fount||[]).push([[5731],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},h="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=u(a),c=r,m=h["".concat(s,".").concat(c)]||h[c]||p[c]||o;return a?n.createElement(m,i(i({ref:t},d),{},{components:a})):n.createElement(m,i({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[h]="string"==typeof e?e:r,i[1]=l;for(var u=2;u<o;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},8949:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(7294),r=a(6010);const o={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:a,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(o.tabItem,i),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>v});var n=a(7462),r=a(7294),o=a(6010),i=a(2466),l=a(6550),s=a(1980),u=a(7392),d=a(12);function h(e){return function(e){return r.Children.map(e,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:r}}=e;return{value:t,label:a,attributes:n,default:r}}))}function p(e){const{values:t,children:a}=e;return(0,r.useMemo)((()=>{const e=t??h(a);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function c(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:a}=e;const n=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,s._X)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(n.location.search);t.set(o,e),n.replace({...n.location,search:t.toString()})}),[o,n])]}function k(e){const{defaultValue:t,queryString:a=!1,groupId:n}=e,o=p(e),[i,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!c({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:o}))),[s,u]=m({queryString:a,groupId:n}),[h,k]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,o]=(0,d.Nk)(a);return[n,(0,r.useCallback)((e=>{a&&o.set(e)}),[a,o])]}({groupId:n}),b=(()=>{const e=s??h;return c({value:e,tabValues:o})?e:null})();(0,r.useLayoutEffect)((()=>{b&&l(b)}),[b]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!c({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),k(e)}),[u,k,o]),tabValues:o}}var b=a(2389);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function f(e){let{className:t,block:a,selectedValue:l,selectValue:s,tabValues:u}=e;const d=[],{blockElementScrollPositionUntilNextRender:h}=(0,i.o5)(),p=e=>{const t=e.currentTarget,a=d.indexOf(t),n=u[a].value;n!==l&&(h(t),s(n))},c=e=>{let t=null;switch(e.key){case"Enter":p(e);break;case"ArrowRight":{const a=d.indexOf(e.currentTarget)+1;t=d[a]??d[0];break}case"ArrowLeft":{const a=d.indexOf(e.currentTarget)-1;t=d[a]??d[d.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":a},t)},u.map((e=>{let{value:t,label:a,attributes:i}=e;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>d.push(e),onKeyDown:c,onClick:p},i,{className:(0,o.Z)("tabs__item",y.tabItem,i?.className,{"tabs__item--active":l===t})}),a??t)})))}function g(e){let{lazy:t,children:a,selectedValue:n}=e;if(a=Array.isArray(a)?a:[a],t){const e=a.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},a.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function w(e){const t=k(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",y.tabList)},r.createElement(f,(0,n.Z)({},e,t)),r.createElement(g,(0,n.Z)({},e,t)))}function v(e){const t=(0,b.Z)();return r.createElement(w,(0,n.Z)({key:String(t)},e))}},728:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>u,toc:()=>h});var n=a(7462),r=(a(7294),a(3905)),o=a(4866),i=a(8949);const l={},s="Webhooks",u={unversionedId:"webhooks",id:"webhooks",title:"Webhooks",description:"Webhooks allow you to receive HTTP push notifications for data changes in BAV. This allows you to build richer",source:"@site/docs/webhooks.md",sourceDirName:".",slug:"/webhooks",permalink:"/docs/2.x/webhooks",draft:!1,editUrl:"https://github.com/wppbav/developer.wppbav.com/edit/main/docs/webhooks.md",tags:[],version:"current",frontMatter:{},sidebar:"apiSidebar",previous:{title:"Versioning",permalink:"/docs/2.x/versioning"},next:{title:"Configurable fields",permalink:"/docs/2.x/customizing/fields"}},d={},h=[{value:"How does a webhook work?",id:"how-does-a-webhook-work",level:2},{value:"Getting started",id:"getting-started",level:2},{value:"Creating the webhook on The Fount",id:"creating-the-webhook-on-the-fount",level:2},{value:"The Webhook Payload",id:"the-webhook-payload",level:2},{value:"Security and validation",id:"security-and-validation",level:2}],p={toc:h},c="wrapper";function m(e){let{components:t,...a}=e;return(0,r.kt)(c,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"webhooks"},"Webhooks"),(0,r.kt)("p",null,"Webhooks allow you to receive HTTP push notifications for data changes in BAV. This allows you to build richer\nintegrations on top of BAV. You could, for example, use it to react in realtime to new data being available or make\naudiences seamlessly available in your own systems."),(0,r.kt)("p",null,"Our webhooks belong to the global platform. You can configure webhooks provide events based on all users and operating\ncompanies or specific users and/or operating companies. For example, you may only want to listen to new audiences\ncreated by users within GroupM."),(0,r.kt)("p",null,'The webhooks come in two categories "data change webhooks" and other events. The data change webhooks are triggered\nwhen data changes in BAV. The other events are triggered when other events occur in BAV.'),(0,r.kt)("p",null,"The data change webhooks are currently supported for the following objects:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Audiences")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Brands")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Brand Metrics")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Collections")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Studies"))),(0,r.kt)("p",null,"The other events are currently supported for the following events:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Audience Export")," - ",(0,r.kt)("a",{parentName:"li",href:"#"},"Documentation"))),(0,r.kt)("h2",{id:"how-does-a-webhook-work"},"How does a webhook work?"),(0,r.kt)("p",null,"A webhook is simple a HTTP POST request to a URL you specify. The request is automatically triggered by BAV when data\nupdates or the event occurs. The request contains a ",(0,r.kt)("a",{parentName:"p",href:"#the-webhook-payload"},"JSON payload")," with the data that has changed\nor the event that has occurred."),(0,r.kt)("p",null,"To receive data from the webhook all you need is a simple HTTP endpoint that:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Is available on a publicly accessible HTTPS, non-localhost URL."),(0,r.kt)("li",{parentName:"ul"},"Responds with a ",(0,r.kt)("inlineCode",{parentName:"li"},"HTTP 200")," status code to the Webhook POST request.")),(0,r.kt)("p",null,"If your endpoint does not respond with a ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTP 200")," status code the request will be retried a few times. We use an\nexponential backoff delay between retried. This means that for each retry the delay between retries will be longer. If\nyour endpoint continues to fail to respond it will be automatically disabled. You'll receive a notification when this\noccurs. It must then be manually re-enabled when the issue has been fixed."),(0,r.kt)("h2",{id:"getting-started"},"Getting started"),(0,r.kt)("p",null,"Implementing webhooks is simpler than you might think. In summary, you'll need to do the following in your application:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Create a receiving endpoint for the webhook."),(0,r.kt)("li",{parentName:"ul"},"Verify the authenticity of the webhook request by validating the signature in the request."),(0,r.kt)("li",{parentName:"ul"},"Parse the JSON payload in the request to get the data that has changed or the event that has occurred and process it."),(0,r.kt)("li",{parentName:"ul"},"Respond to the request with a ",(0,r.kt)("inlineCode",{parentName:"li"},"HTTP 200")," status code.")),(0,r.kt)("p",null,"As some events are triggered by BAV it can be useful to use the sample payloads provided in the documentation to use as\ntest data. This will allow you to test your endpoint without having to wait for the event to occur in BAV."),(0,r.kt)("h2",{id:"creating-the-webhook-on-the-fount"},"Creating the webhook on The Fount"),(0,r.kt)("p",null,"Currently, you cannot create webhooks on The Fount yourself. You will need to reach out to us\nat ",(0,r.kt)("a",{parentName:"p",href:"mailto:support@bernskioldmedia.com"},"support@bernskioldmedia.com"),". We will then add the webhook to the system for\nyou and provide you with the secret key that you will need to verify the authenticity of the webhook requests."),(0,r.kt)("p",null,"You are more than welcome to reach out as you start to plan your integration and we can help you get started."),(0,r.kt)("p",null,"When adding a webhook we will need the following information from you:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The URL of the endpoint that will receive the webhook."),(0,r.kt)("li",{parentName:"ul"},"The events that you want to receive webhooks for. This can be all events or specific events."),(0,r.kt)("li",{parentName:"ul"},"If you want to only receive events for specific users and/or operating companies.")),(0,r.kt)("admonition",{title:"Handle webhooks asynchronously",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"When you receive a webhook request, it is helpful to handle it asynchronously. This will ensure that your application\ncan respond to the webhook request quickly and avoid timeouts. You can use a queue to handle the webhook request and\nthen process it in the background.")),(0,r.kt)("h2",{id:"the-webhook-payload"},"The Webhook Payload"),(0,r.kt)("p",null,"The webhook HTTP payload will include information that you'll need both in its HTTP headers and in its request body."),(0,r.kt)("p",null,"For data change events the request body will include the data that has changed in the same format as the API endpoints\nfor each resource."),(0,r.kt)("p",null,"The payload will be sent with the following headers:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Accept-Charset: utf-8\nContent-Type: application/json\nBAV-Delivery: 7efba5b3-f551-4862-ad1e-2667d09a40bb\nBAV-Event: Brand\nBAV-Signature: d0e1c26711234ca18e4c7c879d5c41a5221db7ea5349c07073573341378aa2b4\nUser-Agent: BAV-Webhook\n")),(0,r.kt)("p",null,"The custom headers sent by BAV are:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"BAV-Delivery")),(0,r.kt)("td",{parentName:"tr",align:null},"A UUID (v4) that uniquely identifies this payload.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"BAV-Event")),(0,r.kt)("td",{parentName:"tr",align:null},"The resource type that triggered this event.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"BAV-Signature")),(0,r.kt)("td",{parentName:"tr",align:null},"The HMAC signature of the webhook payload.")))),(0,r.kt)("p",null,"The payload is sent with the following body:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"action")),(0,r.kt)("td",{parentName:"tr",align:null},"The type of action that took place. This is only available for data change events and is otherwise not present. One of: ",(0,r.kt)("inlineCode",{parentName:"td"},"create"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"update"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"delete"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"data")),(0,r.kt)("td",{parentName:"tr",align:null},"The data for the object in the same format as the object's full response schema. You can find this in the documentation for each endpoint.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"type")),(0,r.kt)("td",{parentName:"tr",align:null},"The type of resource that was targeted.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"url")),(0,r.kt)("td",{parentName:"tr",align:null},"The URL to the object's page on The Fount.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"webhookDate")),(0,r.kt)("td",{parentName:"tr",align:null},"The date of the event in ISO 8601 format.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"webhookTimestamp")),(0,r.kt)("td",{parentName:"tr",align:null},"The date of the event in Unix timestamp format.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"webhookId")),(0,r.kt)("td",{parentName:"tr",align:null},"A UUID (v4) that uniquely identifies this payload.")))),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "action": "create",\n  "data": {\n    "id": 1,\n    "name": "BAV@WPP"\n    // ... other fields\n  },\n  "type": "Brand",\n  "url": "https://fount.wppbav.com/brands/1",\n  "webhookDate": "2024-01-01T00:00:00Z",\n  "webhookTimestamp": 1672531200,\n  "webhookId": "7efba5b3-f551-4862-ad1e-2667d09a40bb"\n}\n')),(0,r.kt)("h2",{id:"security-and-validation"},"Security and validation"),(0,r.kt)("p",null,"When implementing webhooks it is important to secure your endpoint to ensure that the data you receive is from BAV. We\nuse a HMAC signature to sign the payload with a secret key. This signature is included in the ",(0,r.kt)("inlineCode",{parentName:"p"},"BAV-Signature")," header of\nthe request. You should use this signature to verify that the payload was sent by BAV."),(0,r.kt)("p",null,"The payload body also includes ",(0,r.kt)("inlineCode",{parentName:"p"},"webhookTimestamp")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"webhookDate")," fields. We recommend that you use them to verify\nthat they are within a reasonable time frame (\u2248 a minute). This will help to prevent replay attacks."),(0,r.kt)("p",null,"To verify the webhook, calculate the signature from the request body using the webhook secret that we provide you with.\nThen compare the calculated signature with the signature in the ",(0,r.kt)("inlineCode",{parentName:"p"},"BAV-Signature")," header. We recommend using the raw\nrequest body content for the hashing as JSON parsing may change it."),(0,r.kt)("admonition",{title:"Securing the webhook secret",type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"We strongly remind you to keep the webhook secret secure. Do not expose it in your frontend code or in any public or\nprivate repositories. Do not hardcode it into your code. It should be considered as sensitive as a password."),(0,r.kt)("p",{parentName:"admonition"},"If you accidentally expose the secret, or commit it to version control, please contact us immediately so that we can\nreset it for you.")),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"javascript",label:"JavaScript",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const signature = crypto.createHmac("sha256", WEBHOOK_SECRET).update(rawBody).digest("hex");\n\nif (signature !== request.headers[\'bav-signature\']) {\n    throw "Invalid signature"\n}\n'))),(0,r.kt)(i.Z,{value:"php",label:"PHP",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$rawBody = '--- the raw request body ---';\n$receivedSignature = '--- the signature from the BAV-Signature header ---';\n$expectedSignature = hash_hmac('sha256', $rawBody, WEBHOOK_SECRET);\n\nif ($receivedSignature !== $expectedSignature) {\n    throw new Exception('Invalid signature');\n}\n"))),(0,r.kt)(i.Z,{value:"python",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"import hmac\nimport hashlib\n\nsignature = hmac.new(WEBHOOK_SECRET.encode('utf-8'), raw_body, hashlib.sha256).hexdigest()\n\nif signature != request.headers['BAV-Signature']:\n    raise Exception('Invalid signature')\n"))),(0,r.kt)(i.Z,{value:"r",label:"R",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-r"},'library(openssl)\n\nsignature <- hmac("sha256", rawBody, key = WEBHOOK_SECRET, serialize = FALSE)\n\nif (signature != request$headers$`BAV-Signature`) {\n    stop("Invalid signature")\n}\n')))),(0,r.kt)("p",null,"In addition to verifying the signature we recommend that you also verify the ",(0,r.kt)("inlineCode",{parentName:"p"},"webhookTimestamp")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"webhookDate")," fields\nto within approximately a minute of the current time. This will help to prevent replay attacks."))}m.isMDXComponent=!0}}]);